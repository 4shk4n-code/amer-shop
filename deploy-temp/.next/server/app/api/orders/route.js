(()=>{var e={};e.id=146,e.ids=[146],e.modules={62849:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=62849,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},524:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},65642:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>_,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{GET:()=>c,POST:()=>d});var o=r(49303),a=r(88716),i=r(60670),n=r(87070),u=r(75748);async function d(e){try{let t=(0,u.M)(),s=await e.json(),o=null,a=e.headers.get("authorization");if(a&&a.startsWith("Bearer ")){let{verifyToken:e}=await Promise.all([r.e(86),r.e(558)]).then(r.bind(r,95456)),t=a.substring(7),s=e(t);s&&"customer"===s.role&&(o=s.id)}let{customerName:i,customerEmail:d,customerPhone:c,shippingAddress:p,items:l,totalAmount:m,paymentMethod:h,notes:_}=s;if(!i||!d||!c||!p||!l||!m)return n.NextResponse.json({error:"Missing required fields"},{status:400});let x=`ORD-${Date.now()}-${Math.random().toString(36).substr(2,9).toUpperCase()}`,g=await t.getConnection();await g.beginTransaction();try{let[e]=await g.execute(`INSERT INTO orders (
          order_number, user_id, customer_name, customer_email, customer_phone,
          shipping_address, total_amount, payment_method, notes
        ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?)`,[x,o,i,d,c,p,m,h||"cash_on_delivery",_||null]),t=e.insertId,r=l.map(e=>[t,e.productId,e.productName,e.price,e.quantity,e.price*e.quantity]);for(let e of(await g.query(`INSERT INTO order_items (order_id, product_id, product_name, product_price, quantity, subtotal)
         VALUES ?`,[r]),l))await g.execute("UPDATE products SET stock_quantity = stock_quantity - ? WHERE id = ?",[e.quantity,e.productId]);return await g.commit(),g.release(),n.NextResponse.json({success:!0,orderId:t,orderNumber:x},{status:201})}catch(e){throw await g.rollback(),g.release(),e}}catch(e){return console.error("Error creating order:",e),n.NextResponse.json({error:"Failed to create order",message:e.message},{status:500})}}async function c(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return n.NextResponse.json({error:"Unauthorized"},{status:401});let s=t.substring(7),{verifyToken:o}=await Promise.all([r.e(86),r.e(558)]).then(r.bind(r,95456)),a=o(s);if(!a||"admin"!==a.role)return n.NextResponse.json({error:"Unauthorized"},{status:401});let i=(0,u.M)(),{searchParams:d}=new URL(e.url),c=parseInt(d.get("page")||"1"),p=parseInt(d.get("limit")||"20"),l=(c-1)*p,[m]=await i.execute(`SELECT 
        o.*,
        COUNT(oi.id) as item_count
      FROM orders o
      LEFT JOIN order_items oi ON o.id = oi.order_id
      GROUP BY o.id
      ORDER BY o.created_at DESC
      LIMIT ? OFFSET ?`,[p,l]),[h]=await i.execute("SELECT COUNT(*) as total FROM orders"),_=h[0]?.total||0,x=m.map(e=>({id:e.id,orderNumber:e.order_number,customerName:e.customer_name,customerEmail:e.customer_email,customerPhone:e.customer_phone,shippingAddress:e.shipping_address,totalAmount:parseFloat(e.total_amount),status:e.status,paymentMethod:e.payment_method,paymentStatus:e.payment_status,itemCount:e.item_count,createdAt:e.created_at,updatedAt:e.updated_at}));return n.NextResponse.json({orders:x,pagination:{page:c,limit:p,total:_,totalPages:Math.ceil(_/p)}})}catch(e){return console.error("Error fetching orders:",e),n.NextResponse.json({error:"Failed to fetch orders",message:e.message},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"E:\\amertrading.shop\\src\\app\\api\\orders\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:h}=p,_="/api/orders/route";function x(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},75748:(e,t,r)=>{"use strict";r.d(t,{M:()=>a});var s=r(73785);let o=null;function a(){return o||(o=s.createPool({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"amer_shop",waitForConnections:!0,connectionLimit:10,queueLimit:0})),o}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,785],()=>r(65642));module.exports=s})();