(()=>{var e={};e.id=87,e.ids=[87,558],e.modules={62849:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=62849,e.exports=r},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},524:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},80692:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>f,patchFetch:()=>E,requestAsyncStorage:()=>m,routeModule:()=>l,serverHooks:()=>x,staticGenerationAsyncStorage:()=>h});var s={};t.r(s),t.d(s,{GET:()=>c,PUT:()=>p});var o=t(49303),n=t(88716),i=t(60670),u=t(87070),a=t(75748),d=t(34948);async function c(e,{params:r}){try{let s=(0,a.M)(),o=parseInt(r.id),n=e.headers.get("authorization"),i=null,d=!1;if(n&&n.startsWith("Bearer ")){let{verifyToken:e}=await Promise.resolve().then(t.bind(t,95456)),r=n.substring(7),s=e(r);s&&(i=s.id,d="admin"===s.role)}if(!i)return u.NextResponse.json({error:"Unauthorized"},{status:401});let[c]=await s.execute("SELECT * FROM orders WHERE id = ?",[o]);if(!c||0===c.length)return u.NextResponse.json({error:"Order not found"},{status:404});let p=c[0];if(!d&&p.user_id!==i)return u.NextResponse.json({error:"Unauthorized"},{status:403});let[l]=await s.execute("SELECT * FROM order_items WHERE order_id = ?",[o]);return u.NextResponse.json({order:{id:p.id,orderNumber:p.order_number,customerName:p.customer_name,customerEmail:p.customer_email,customerPhone:p.customer_phone,shippingAddress:p.shipping_address,totalAmount:parseFloat(p.total_amount),status:p.status,paymentMethod:p.payment_method,paymentStatus:p.payment_status,notes:p.notes,createdAt:p.created_at,updatedAt:p.updated_at},items:l.map(e=>({id:e.id,productId:e.product_id,productName:e.product_name,productPrice:parseFloat(e.product_price),quantity:e.quantity,subtotal:parseFloat(e.subtotal)}))})}catch(e){return console.error("Error fetching order:",e),u.NextResponse.json({error:"Failed to fetch order",message:e.message},{status:500})}}async function p(e,{params:r}){try{if(!(0,d.m)(e))return u.NextResponse.json({error:"Unauthorized"},{status:401});let t=(0,a.M)(),s=parseInt(r.id),{status:o,paymentStatus:n}=await e.json();return o&&await t.execute("UPDATE orders SET status = ? WHERE id = ?",[o,s]),n&&await t.execute("UPDATE orders SET payment_status = ? WHERE id = ?",[n,s]),u.NextResponse.json({success:!0})}catch(e){return console.error("Error updating order:",e),u.NextResponse.json({error:"Failed to update order",message:e.message},{status:500})}}let l=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/orders/[id]/route",pathname:"/api/orders/[id]",filename:"route",bundlePath:"app/api/orders/[id]/route"},resolvedPagePath:"E:\\amertrading.shop\\src\\app\\api\\orders\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:x}=l,f="/api/orders/[id]/route";function E(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:h})}},95456:(e,r,t)=>{"use strict";t.d(r,{Oe:()=>a,RA:()=>d,c_:()=>u,verifyToken:()=>c});var s=t(98691),o=t(41482),n=t.n(o);let i=process.env.JWT_SECRET||"your-secret-key-change-in-production";function u(e){return s.ZP.hashSync(e,10)}function a(e,r){return s.ZP.compareSync(e,r)}function d(e){return n().sign(e,i,{expiresIn:"7d"})}function c(e){try{return n().verify(e,i)}catch{return null}}},75748:(e,r,t)=>{"use strict";t.d(r,{M:()=>n});var s=t(73785);let o=null;function n(){return o||(o=s.createPool({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"amer_shop",waitForConnections:!0,connectionLimit:10,queueLimit:0})),o}},34948:(e,r,t)=>{"use strict";t.d(r,{m:()=>o});var s=t(95456);function o(e){let r=function(e){let r=e.headers.get("authorization");return r&&r.startsWith("Bearer ")?r.substring(7):null}(e);if(!r)return null;let t=(0,s.verifyToken)(r);return t&&"admin"===t.role?t:null}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,785,86],()=>t(80692));module.exports=s})();