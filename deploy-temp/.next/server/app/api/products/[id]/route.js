(()=>{var e={};e.id=898,e.ids=[898,558],e.modules={62849:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=62849,e.exports=r},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},524:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},73659:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>x,patchFetch:()=>y,requestAsyncStorage:()=>g,routeModule:()=>_,serverHooks:()=>m,staticGenerationAsyncStorage:()=>E});var s={};t.r(s),t.d(s,{DELETE:()=>l,GET:()=>p,PUT:()=>d});var i=t(49303),o=t(88716),u=t(60670),n=t(87070),a=t(75748),c=t(34948);async function p(e,{params:r}){try{let e=(0,a.M)(),t=parseInt(r.id),[s]=await e.execute(`SELECT 
        p.*,
        c.name as category_name,
        c.slug as category_slug
      FROM products p
      LEFT JOIN categories c ON p.category_id = c.id
      WHERE p.id = ? AND p.is_active = 1`,[t]);if(!s||0===s.length)return n.NextResponse.json({error:"Product not found"},{status:404});let i=s[0],[o]=await e.execute(`SELECT image_url, alt_text, is_primary, sort_order
       FROM product_images
       WHERE product_id = ?
       ORDER BY is_primary DESC, sort_order ASC`,[t]),[u]=await e.execute(`SELECT spec_key, spec_value
       FROM product_specifications
       WHERE product_id = ?
       ORDER BY sort_order ASC`,[t]),c={};u.forEach(e=>{c[e.spec_key]=e.spec_value});let p={id:i.id,name:i.name,slug:i.slug,description:i.description,shortDescription:i.short_description,price:parseFloat(i.price),originalPrice:i.original_price?parseFloat(i.original_price):null,sku:i.sku,category:{id:i.category_id,name:i.category_name,slug:i.category_slug},stockQuantity:i.stock_quantity,inStock:1===i.is_in_stock,rating:parseFloat(i.rating||0),reviewCount:i.review_count||0,images:o.map(e=>e.image_url),specifications:c,createdAt:i.created_at,updatedAt:i.updated_at};return n.NextResponse.json(p)}catch(e){return console.error("Error fetching product:",e),n.NextResponse.json({error:"Failed to fetch product",message:e.message},{status:500})}}async function d(e,{params:r}){try{if(!(0,c.m)(e))return n.NextResponse.json({error:"Unauthorized"},{status:401});let t=(0,a.M)(),s=parseInt(r.id),{name:i,slug:o,description:u,shortDescription:p,price:d,originalPrice:l,sku:_,categoryId:g,stockQuantity:E,isInStock:m,images:x,specifications:y}=await e.json();if(await t.execute(`UPDATE products SET
        name = ?,
        slug = ?,
        description = ?,
        short_description = ?,
        price = ?,
        original_price = ?,
        sku = ?,
        category_id = ?,
        stock_quantity = ?,
        is_in_stock = ?
      WHERE id = ?`,[i,o,u||null,p||null,d,l||null,_||null,g,E||0,!1!==m?1:0,s]),x&&(await t.execute("DELETE FROM product_images WHERE product_id = ?",[s]),x.length>0)){let e=x.map((e,r)=>[s,e,null,r,0===r?1:0]);await t.query(`INSERT INTO product_images (product_id, image_url, alt_text, sort_order, is_primary)
           VALUES ?`,[e])}if(y&&(await t.execute("DELETE FROM product_specifications WHERE product_id = ?",[s]),Object.keys(y).length>0)){let e=Object.entries(y).map(([e,r],t)=>[s,e,String(r),t]);await t.query(`INSERT INTO product_specifications (product_id, spec_key, spec_value, sort_order)
           VALUES ?`,[e])}return n.NextResponse.json({success:!0})}catch(e){return console.error("Error updating product:",e),n.NextResponse.json({error:"Failed to update product",message:e.message},{status:500})}}async function l(e,{params:r}){try{if(!(0,c.m)(e))return n.NextResponse.json({error:"Unauthorized"},{status:401});let t=(0,a.M)(),s=parseInt(r.id);return await t.execute("UPDATE products SET is_active = 0 WHERE id = ?",[s]),n.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting product:",e),n.NextResponse.json({error:"Failed to delete product",message:e.message},{status:500})}}let _=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/products/[id]/route",pathname:"/api/products/[id]",filename:"route",bundlePath:"app/api/products/[id]/route"},resolvedPagePath:"E:\\amertrading.shop\\src\\app\\api\\products\\[id]\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:E,serverHooks:m}=_,x="/api/products/[id]/route";function y(){return(0,u.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:E})}},95456:(e,r,t)=>{"use strict";t.d(r,{Oe:()=>a,RA:()=>c,c_:()=>n,verifyToken:()=>p});var s=t(98691),i=t(41482),o=t.n(i);let u=process.env.JWT_SECRET||"your-secret-key-change-in-production";function n(e){return s.ZP.hashSync(e,10)}function a(e,r){return s.ZP.compareSync(e,r)}function c(e){return o().sign(e,u,{expiresIn:"7d"})}function p(e){try{return o().verify(e,u)}catch{return null}}},75748:(e,r,t)=>{"use strict";t.d(r,{M:()=>o});var s=t(73785);let i=null;function o(){return i||(i=s.createPool({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"amer_shop",waitForConnections:!0,connectionLimit:10,queueLimit:0})),i}},34948:(e,r,t)=>{"use strict";t.d(r,{m:()=>i});var s=t(95456);function i(e){let r=function(e){let r=e.headers.get("authorization");return r&&r.startsWith("Bearer ")?r.substring(7):null}(e);if(!r)return null;let t=(0,s.verifyToken)(r);return t&&"admin"===t.role?t:null}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,785,86],()=>t(73659));module.exports=s})();