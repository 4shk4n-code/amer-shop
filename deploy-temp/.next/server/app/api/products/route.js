(()=>{var e={};e.id=684,e.ids=[684,558],e.modules={62849:e=>{function r(e){var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}r.keys=()=>[],r.resolve=r,r.id=62849,e.exports=r},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},524:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},21566:(e,r,t)=>{"use strict";t.r(r),t.d(r,{originalPathname:()=>h,patchFetch:()=>E,requestAsyncStorage:()=>g,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>_});var s={};t.r(s),t.d(s,{GET:()=>p,POST:()=>d});var i=t(49303),o=t(88716),a=t(60670),n=t(87070),u=t(75748),c=t(34948);async function p(e){try{let r=(0,u.M)(),{searchParams:t}=new URL(e.url),s=t.get("category"),i=t.get("search"),o=parseInt(t.get("page")||"1"),a=parseInt(t.get("limit")||"20"),c=(o-1)*a,p=`
      FROM products p
      LEFT JOIN categories c ON p.category_id = c.id
      WHERE p.is_active = 1
    `,d=[];if(s&&(p+=" AND c.slug = ?",d.push(s)),i){p+=" AND (p.name LIKE ? OR p.description LIKE ? OR p.short_description LIKE ?)";let e=`%${i}%`;d.push(e,e,e)}let l=`
      SELECT 
        p.*,
        c.name as category_name,
        c.slug as category_slug
      ${p}
      ORDER BY p.created_at DESC
      LIMIT ${parseInt(String(a))} OFFSET ${parseInt(String(c))}
    `,[g]=await r.execute(l,d);if(g.length>0){let e=g.map(e=>e.id);if(e.length>0){let[t]=await r.execute(`SELECT product_id, image_url, sort_order, is_primary 
           FROM product_images 
           WHERE product_id IN (${e.map(()=>"?").join(",")})
           ORDER BY product_id, sort_order, is_primary DESC`,e),s={};t.forEach(e=>{s[e.product_id]||(s[e.product_id]=[]),s[e.product_id].push(e.image_url)}),g.forEach(e=>{e.images=s[e.id]||[]})}else g.forEach(e=>{e.images=[]})}let _=`SELECT COUNT(*) as total ${p}`,[m]=await r.execute(_,d),h=m[0]?.total||0,E=g.map(e=>({id:e.id,name:e.name,slug:e.slug,description:e.description,shortDescription:e.short_description,price:parseFloat(e.price),originalPrice:e.original_price?parseFloat(e.original_price):null,sku:e.sku,category:{id:e.category_id,name:e.category_name,slug:e.category_slug},stockQuantity:e.stock_quantity,inStock:1===e.is_in_stock,rating:parseFloat(e.rating||0),reviewCount:e.review_count||0,images:e.images||[],createdAt:e.created_at,updatedAt:e.updated_at}));return n.NextResponse.json({products:E,pagination:{page:o,limit:a,total:h,totalPages:Math.ceil(h/a)}})}catch(e){return console.error("Error fetching products:",e),console.error("Error stack:",e.stack),n.NextResponse.json({error:"Failed to fetch products",message:e.message,details:void 0},{status:500})}}async function d(e){try{if(!(0,c.m)(e))return n.NextResponse.json({error:"Unauthorized"},{status:401});let r=(0,u.M)(),{name:t,slug:s,description:i,shortDescription:o,price:a,originalPrice:p,sku:d,categoryId:l,stockQuantity:g,isInStock:_,images:m,specifications:h}=await e.json();if(!t||!a||!l)return n.NextResponse.json({error:"Missing required fields: name, price, categoryId"},{status:400});let E=s||t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),[y]=await r.execute(`INSERT INTO products (
        name, slug, description, short_description, price, original_price, sku,
        category_id, stock_quantity, is_in_stock
      ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,[t,E,i||null,o||null,a,p||null,d||null,l,g||0,!1!==_?1:0]),f=y.insertId;if(m&&m.length>0){let e=m.map((e,r)=>[f,e,null,r,0===r?1:0]);await r.query(`INSERT INTO product_images (product_id, image_url, alt_text, sort_order, is_primary)
         VALUES ?`,[e])}if(h&&Object.keys(h).length>0){let e=Object.entries(h).map(([e,r],t)=>[f,e,String(r),t]);await r.query(`INSERT INTO product_specifications (product_id, spec_key, spec_value, sort_order)
         VALUES ?`,[e])}return n.NextResponse.json({success:!0,productId:f},{status:201})}catch(e){return console.error("Error creating product:",e),n.NextResponse.json({error:"Failed to create product",message:e.message},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/products/route",pathname:"/api/products",filename:"route",bundlePath:"app/api/products/route"},resolvedPagePath:"E:\\amertrading.shop\\src\\app\\api\\products\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:_,serverHooks:m}=l,h="/api/products/route";function E(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:_})}},95456:(e,r,t)=>{"use strict";t.d(r,{Oe:()=>u,RA:()=>c,c_:()=>n,verifyToken:()=>p});var s=t(98691),i=t(41482),o=t.n(i);let a=process.env.JWT_SECRET||"your-secret-key-change-in-production";function n(e){return s.ZP.hashSync(e,10)}function u(e,r){return s.ZP.compareSync(e,r)}function c(e){return o().sign(e,a,{expiresIn:"7d"})}function p(e){try{return o().verify(e,a)}catch{return null}}},75748:(e,r,t)=>{"use strict";t.d(r,{M:()=>o});var s=t(73785);let i=null;function o(){return i||(i=s.createPool({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"amer_shop",waitForConnections:!0,connectionLimit:10,queueLimit:0})),i}},34948:(e,r,t)=>{"use strict";t.d(r,{m:()=>i});var s=t(95456);function i(e){let r=function(e){let r=e.headers.get("authorization");return r&&r.startsWith("Bearer ")?r.substring(7):null}(e);if(!r)return null;let t=(0,s.verifyToken)(r);return t&&"admin"===t.role?t:null}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,785,86],()=>t(21566));module.exports=s})();