(()=>{var e={};e.id=553,e.ids=[553,558],e.modules={62849:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=62849,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},524:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},78624:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>_,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>E});var s={};r.r(s),r.d(s,{GET:()=>d});var o=r(49303),i=r(88716),a=r(60670),n=r(87070),u=r(75748),c=r(34948);async function d(e){try{if(!(0,c.m)(e))return n.NextResponse.json({error:"Unauthorized"},{status:401});let t=(0,u.M)(),[r]=await t.execute("SELECT COUNT(*) as total, SUM(CASE WHEN is_active = 1 THEN 1 ELSE 0 END) as active, SUM(CASE WHEN is_in_stock = 0 THEN 1 ELSE 0 END) as out_of_stock FROM products"),[s]=await t.execute(`SELECT 
        COUNT(*) as total_orders,
        SUM(CASE WHEN status = 'pending' THEN 1 ELSE 0 END) as pending,
        SUM(CASE WHEN status = 'processing' THEN 1 ELSE 0 END) as processing,
        SUM(CASE WHEN status = 'delivered' THEN 1 ELSE 0 END) as delivered,
        SUM(total_amount) as total_revenue
      FROM orders`),[o]=await t.execute(`SELECT o.*, COUNT(oi.id) as item_count
       FROM orders o
       LEFT JOIN order_items oi ON o.id = oi.order_id
       GROUP BY o.id
       ORDER BY o.created_at DESC
       LIMIT 5`),[i]=await t.execute(`SELECT p.id, p.name, SUM(oi.quantity) as total_sold, SUM(oi.subtotal) as revenue
       FROM products p
       LEFT JOIN order_items oi ON p.id = oi.product_id
       GROUP BY p.id
       ORDER BY total_sold DESC
       LIMIT 5`);return n.NextResponse.json({products:{total:r[0]?.total||0,active:r[0]?.active||0,outOfStock:r[0]?.out_of_stock||0},orders:{total:s[0]?.total_orders||0,pending:s[0]?.pending||0,processing:s[0]?.processing||0,delivered:s[0]?.delivered||0,revenue:parseFloat(s[0]?.total_revenue||0)},recentOrders:o.map(e=>({id:e.id,orderNumber:e.order_number,customerName:e.customer_name,totalAmount:parseFloat(e.total_amount),status:e.status,itemCount:e.item_count,createdAt:e.created_at})),topProducts:i.map(e=>({id:e.id,name:e.name,totalSold:e.total_sold||0,revenue:parseFloat(e.revenue||0)}))})}catch(e){return console.error("Error fetching stats:",e),n.NextResponse.json({error:"Failed to fetch stats",message:e.message},{status:500})}}let p=new o.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/admin/stats/route",pathname:"/api/admin/stats",filename:"route",bundlePath:"app/api/admin/stats/route"},resolvedPagePath:"E:\\amertrading.shop\\src\\app\\api\\admin\\stats\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:l,staticGenerationAsyncStorage:E,serverHooks:m}=p,v="/api/admin/stats/route";function _(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:E})}},95456:(e,t,r)=>{"use strict";r.d(t,{Oe:()=>u,RA:()=>c,c_:()=>n,verifyToken:()=>d});var s=r(98691),o=r(41482),i=r.n(o);let a=process.env.JWT_SECRET||"your-secret-key-change-in-production";function n(e){return s.ZP.hashSync(e,10)}function u(e,t){return s.ZP.compareSync(e,t)}function c(e){return i().sign(e,a,{expiresIn:"7d"})}function d(e){try{return i().verify(e,a)}catch{return null}}},75748:(e,t,r)=>{"use strict";r.d(t,{M:()=>i});var s=r(73785);let o=null;function i(){return o||(o=s.createPool({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PASSWORD||"",database:process.env.DB_NAME||"amer_shop",waitForConnections:!0,connectionLimit:10,queueLimit:0})),o}},34948:(e,t,r)=>{"use strict";r.d(t,{m:()=>o});var s=r(95456);function o(e){let t=function(e){let t=e.headers.get("authorization");return t&&t.startsWith("Bearer ")?t.substring(7):null}(e);if(!t)return null;let r=(0,s.verifyToken)(t);return r&&"admin"===r.role?r:null}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,785,86],()=>r(78624));module.exports=s})();