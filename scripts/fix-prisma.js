// Fix Prisma 7 client structure - create default.js that @prisma/client expects
const fs = require('fs');
const path = require('path');

const prismaClientPath = path.join(__dirname, '../.prisma/client');
const defaultJsPath = path.join(prismaClientPath, 'default.js');
const indexJsPath = path.join(prismaClientPath, 'index.js');

// Check if .prisma/client directory exists
if (!fs.existsSync(prismaClientPath)) {
  console.log('⚠️  Prisma Client directory not found at', prismaClientPath);
  console.log('   This is normal if Prisma hasn\'t generated yet. Skipping fix.');
  process.exit(0); // Don't fail, just skip
}

// Prisma 7 generates TypeScript files, but we need JavaScript entry points
// Create index.js that will be compiled by Next.js/TypeScript
// Create default.js that re-exports from index.js

// First, create index.js that exports from client.ts (TypeScript will compile it)
const indexContent = `// This file is auto-generated by fix-prisma.js
// Re-export from the generated TypeScript client
// Next.js will compile this TypeScript import during build
export * from './client';
export { PrismaClient } from './client';
`;

// Then create default.js that re-exports from index.js
// At runtime, index.js will have been compiled to JavaScript
const defaultContent = `// This file is auto-generated by fix-prisma.js
// Re-export from index.js (which will be compiled from TypeScript)
module.exports = require('./index.js');
`;

fs.writeFileSync(indexJsPath, indexContent);
fs.writeFileSync(defaultJsPath, defaultContent);
console.log('✅ Created .prisma/client/index.js and default.js');
