// Fix Prisma 7 client structure - create default.js that @prisma/client expects
const fs = require('fs');
const path = require('path');

const prismaClientPath = path.join(__dirname, '../node_modules/.prisma/client');
const defaultJsPath = path.join(prismaClientPath, 'default.js');

// Check if .prisma/client directory exists
if (!fs.existsSync(prismaClientPath)) {
  console.log('‚ö†Ô∏è  Prisma Client directory not found at', prismaClientPath);
  console.log('   This is normal if Prisma hasn\'t generated yet. Skipping fix.');
  process.exit(0); // Don't fail, just skip
}

// List files to see what Prisma generated
const files = fs.readdirSync(prismaClientPath);
console.log('üìÅ Files in node_modules/.prisma/client:', files.join(', '));

// Create a simple default.js that re-exports from the generated client
// The client.ts will be handled by Next.js TypeScript compilation
// We just need this file to exist for module resolution
const defaultContent = `// This file is auto-generated by fix-prisma.js
// Prisma 7 generates TypeScript files, but @prisma/client expects this JS file
// This file exists purely for module resolution - the actual client is loaded via @prisma/client

// Re-export everything from the generated client
// At runtime, Next.js will have compiled the TypeScript, so this will work
// We use a try-catch to handle cases where the client might not be compiled yet during build
try {
  module.exports = require('./client');
} catch (e) {
  // If client.ts isn't available, create a minimal export
  // This should only happen during build if there's an issue
  const { PrismaClient: BasePrismaClient } = require('@prisma/client');
  module.exports = { PrismaClient: BasePrismaClient };
}
`;

fs.writeFileSync(defaultJsPath, defaultContent);
console.log('‚úÖ Created node_modules/.prisma/client/default.js');
