// Fix Prisma 7 client structure - create default.js that @prisma/client expects
const fs = require('fs');
const path = require('path');

const prismaClientPath = path.join(__dirname, '../node_modules/.prisma/client');
const defaultJsPath = path.join(prismaClientPath, 'default.js');

// Check if .prisma/client directory exists
if (!fs.existsSync(prismaClientPath)) {
  console.log('‚ö†Ô∏è  Prisma Client directory not found at', prismaClientPath);
  console.log('   This is normal if Prisma hasn\'t generated yet. Skipping fix.');
  process.exit(0); // Don't fail, just skip
}

// List files to see what Prisma generated
const files = fs.readdirSync(prismaClientPath);
console.log('üìÅ Files in node_modules/.prisma/client:', files.join(', '));

// Prisma 7 generates TypeScript files, but @prisma/client expects default.js
// Create default.js that properly exports PrismaClient
// The generated client.ts will be compiled by Next.js, so we need to handle both cases

const defaultContent = `// This file is auto-generated by fix-prisma.js
// Prisma 7 generates TypeScript files, but @prisma/client expects this JS file
// We need to export PrismaClient in a way that works at runtime

// Try to load from the generated client (will be compiled by Next.js)
try {
  // At runtime, the TypeScript will be compiled, so we can require it
  const client = require('./client');
  module.exports = client;
  module.exports.PrismaClient = client.PrismaClient || client.default?.PrismaClient;
} catch (e) {
  // Fallback: use the Prisma runtime library
  try {
    const { PrismaClient } = require('@prisma/client/runtime/library');
    module.exports = { PrismaClient };
  } catch (e2) {
    // Last resort: create a proxy that will work
    console.warn('Prisma Client loading fallback');
    module.exports = {};
  }
}
`;

fs.writeFileSync(defaultJsPath, defaultContent);
console.log('‚úÖ Created node_modules/.prisma/client/default.js');

